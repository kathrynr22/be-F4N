<html>
  <head>
    <title>Authentication Example</title>
  </head>

  <body>
    <form>
      <div>
        <input id="email" type="text" placeholder="Email..." />
      </div>
      <div>
        <input id="password" type="password" placeholder="Password..." />
      </div>
      <div>
        <button id="sign-in">Sign In/Register</button>
        <button id="request-data">Request-Data</button>
        <button id="sign-out">Sign Out</button>
      </div>
    </form>

    <!--Include firebase.js  -->
    <script src="https://www.gstatic.com/firebasejs/live/3.0/firebase.js"></script>

    <!--Configure firebase-->
    <script>
      // Visit https://console.firebase.google.com/project/<your project id>/overview and click on "Add Firebase to your web app"
      var firebaseConfig = {
        apiKey: 'AIzaSyCAAUCqfPBaBmyo24oc_3cmBwZR_gL2x68',
        authDomain: 'f-4-n-a30d4.firebaseapp.com',
        databaseURL: 'https://f-4-n-a30d4.firebaseio.com/',
        projectId: 'f-4-n-a30d4',
        storageBucket: 'f-4-n-a30d4.appspot.com',
        messagingSenderId: '461541941279',
        appId: '1:461541941279:web:1fc960ba6ac623f9e7f52a',
      };
      firebase.initializeApp(firebaseConfig);
    </script>

    <!--Register a new user-->
    <script>
      const num = Math.random();

      firebase
        .auth()
        .createUserWithEmailAndPassword(
          `letshopethisworks${num}@fingerscrossed.co.uk`,
          'mycrazylongpasswo55555rdofdoom'
        )
        .catch(function (err) {
          console.log(err);
        });
    </script>

    <!--Handle Login-->
    <script>
      document
        .querySelector('#sign-in')
        .addEventListener('click', function (e) {
          e.preventDefault();
          e.stopPropagation();
          var email = document.querySelector('#email').value;
          var password = document.querySelector('#password').value;

          firebase
            .auth()
            .signInWithEmailAndPassword(email, password)
            .then(currentUser => {
              console.log(currentUser);

              document
                .querySelector('#request-data')
                .addEventListener('click', function (e) {
                  e.preventDefault();
                  e.stopPropagation();

                  currentUser
                    .getToken(true)
                    .then(idToken => {
                      fetch('http://localhost:9090/api', {
                        headers: { AuthToken: idToken },
                      })
                        .then(buffer => buffer.json())
                        .then(res => console.log(res))
                        .catch(err => {
                          console.log(err);
                        });
                    })
                    .catch(function (err) {
                      console.log(err);
                      var errorCode = error.code;
                      var errorMessage = error.message;
                      // ...
                    });
                });
            })
            .catch(function (error) {
              // Handle Errors here.
              console.log(error);
              var errorCode = error.code;
              var errorMessage = error.message;
              // ...
            });
        });
    </script>

    <!--Handle Logout-->
    <script>
      document
        .querySelector('#sign-out')
        .addEventListener('click', function (e) {
          e.preventDefault();
          e.stopPropagation();
          const signOut = firebase
            .auth()
            .signOut()
            .catch(function (err) {
              console.log(err);
            });
          console.log(signOut);
        });
    </script>
  </body>
</html>
